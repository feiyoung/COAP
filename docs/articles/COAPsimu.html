<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>COAP: simulation • COAP</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="COAP: simulation">
<meta property="og:description" content="COAP">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">COAP</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/COAPsimu.html">COAP: simulation</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/feiyoung/COAP/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>COAP: simulation</h1>
                        <h4 data-toc-skip class="author">Wei Liu</h4>
            
            <h4 data-toc-skip class="date">2023-10-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/feiyoung/COAP/blob/HEAD/vignettes/COAPsimu.Rmd" class="external-link"><code>vignettes/COAPsimu.Rmd</code></a></small>
      <div class="hidden name"><code>COAPsimu.Rmd</code></div>

    </div>

    
    
<p>This vignette introduces the usage of COAP for the analysis of high-dimensional count data with additional high-dimensional covariates, by comparison with other methods.</p>
<p>The package can be loaded with the command:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/feiyoung/COAP" class="external-link">COAP</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/feiyoung/GFM" class="external-link">GFM</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: doSNOW</span>
<span class="co">#&gt; Loading required package: foreach</span>
<span class="co">#&gt; Loading required package: iterators</span>
<span class="co">#&gt; Loading required package: snow</span>
<span class="co">#&gt; Loading required package: parallel</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'parallel'</span>
<span class="co">#&gt; The following objects are masked from 'package:snow':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     clusterApply, clusterApplyLB, clusterCall, clusterEvalQ,</span>
<span class="co">#&gt;     clusterExport, clusterMap, clusterSplit, makeCluster, parApply,</span>
<span class="co">#&gt;     parCapply, parLapply, parRapply, parSapply, splitIndices,</span>
<span class="co">#&gt;     stopCluster</span>
<span class="co">#&gt; GFM :  Generalized factor model is implemented for ultra-high dimensional data with mixed-type variables.</span>
<span class="co">#&gt; Two algorithms, variational EM and alternate maximization, are designed to implement the generalized factor model,</span>
<span class="co">#&gt; respectively. The factor matrix and loading matrix together with the number of factors can be well estimated.</span>
<span class="co">#&gt; This model can be employed in social and behavioral sciences, economy and finance, and  genomics,</span>
<span class="co">#&gt; to extract interpretable nonlinear factors. More details can be referred to</span>
<span class="co">#&gt; Wei Liu, Huazhen Lin, Shurong Zheng and Jin Liu. (2021) &lt;doi:10.1080/01621459.2021.1999818&gt;.   Check out our Package website (https://feiyoung.github.io/GFM/docs/index.html) for a more complete description of the methods and analyses</span></code></pre></div>
<div class="section level2">
<h2 id="generate-the-simulated-data">Generate the simulated data<a class="anchor" aria-label="anchor" href="#generate-the-simulated-data"></a>
</h2>
<p>First, we generate the data simulated data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span>; <span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">200</span>; 
<span class="va">d</span><span class="op">=</span> <span class="fl">50</span>
<span class="va">rank0</span> <span class="op">&lt;-</span> <span class="fl">6</span>;
<span class="va">q</span> <span class="op">=</span> <span class="fl">5</span>;
<span class="va">datList</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gendata_simu.html">gendata_simu</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">1</span>, n<span class="op">=</span><span class="va">n</span>, p<span class="op">=</span><span class="va">p</span>, d<span class="op">=</span> <span class="va">d</span>, rank0 <span class="op">=</span> <span class="va">rank0</span>, q<span class="op">=</span> <span class="va">q</span>, rho<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,
                        sigma2_eps <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: MASS</span>
<span class="va">X_count</span> <span class="op">&lt;-</span> <span class="va">datList</span><span class="op">$</span><span class="va">X</span>; <span class="va">Z</span> <span class="op">&lt;-</span> <span class="va">datList</span><span class="op">$</span><span class="va">Z</span>
<span class="va">H0</span> <span class="op">&lt;-</span> <span class="va">datList</span><span class="op">$</span><span class="va">H0</span>; <span class="va">B0</span> <span class="op">&lt;-</span> <span class="va">datList</span><span class="op">$</span><span class="va">B0</span>
<span class="va">bbeta0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="va">datList</span><span class="op">$</span><span class="va">mu0</span>, <span class="va">datList</span><span class="op">$</span><span class="va">bbeta0</span><span class="op">)</span></code></pre></div>
<p>Fit the COAP model using the function <code><a href="../reference/RR_COAP.html">RR_COAP()</a></code> in the R package <code>COAP</code>. Users can use <code><a href="../reference/RR_COAP.html">?RR_COAP</a></code> to see the details about this function</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hq</span> <span class="op">&lt;-</span> <span class="fl">5</span>; <span class="va">hr</span> <span class="op">&lt;-</span> <span class="fl">6</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">tic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">reslist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RR_COAP.html">RR_COAP</a></span><span class="op">(</span><span class="va">X_count</span>, Z<span class="op">=</span> <span class="va">Z</span>, q<span class="op">=</span><span class="va">hq</span>, rank_use<span class="op">=</span> <span class="va">hr</span>, epsELBO <span class="op">=</span> <span class="fl">1e-6</span><span class="op">)</span>
  <span class="va">toc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">time_coap</span> <span class="op">&lt;-</span> <span class="va">toc</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">tic</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; Calculate initial values...</span>
<span class="co">#&gt; Loading required package: irlba</span>
<span class="co">#&gt; Loading required package: Matrix</span>
<span class="co">#&gt; iter = 2, ELBO= 311531.420000, dELBO=1.000145 </span>
<span class="co">#&gt; iter = 3, ELBO= 316042.737970, dELBO=0.014481 </span>
<span class="co">#&gt; iter = 4, ELBO= 317869.490388, dELBO=0.005780 </span>
<span class="co">#&gt; iter = 5, ELBO= 318776.120476, dELBO=0.002852 </span>
<span class="co">#&gt; iter = 6, ELBO= 319290.972752, dELBO=0.001615 </span>
<span class="co">#&gt; iter = 7, ELBO= 319611.373938, dELBO=0.001003 </span>
<span class="co">#&gt; iter = 8, ELBO= 319824.015899, dELBO=0.000665 </span>
<span class="co">#&gt; iter = 9, ELBO= 319971.850666, dELBO=0.000462 </span>
<span class="co">#&gt; iter = 10, ELBO= 320078.245025, dELBO=0.000333 </span>
<span class="co">#&gt; iter = 11, ELBO= 320156.887531, dELBO=0.000246 </span>
<span class="co">#&gt; iter = 12, ELBO= 320216.278565, dELBO=0.000186 </span>
<span class="co">#&gt; iter = 13, ELBO= 320261.942528, dELBO=0.000143 </span>
<span class="co">#&gt; iter = 14, ELBO= 320297.599344, dELBO=0.000111 </span>
<span class="co">#&gt; iter = 15, ELBO= 320325.824786, dELBO=0.000088 </span>
<span class="co">#&gt; iter = 16, ELBO= 320348.442910, dELBO=0.000071 </span>
<span class="co">#&gt; iter = 17, ELBO= 320366.769724, dELBO=0.000057 </span>
<span class="co">#&gt; iter = 18, ELBO= 320381.769961, dELBO=0.000047 </span>
<span class="co">#&gt; iter = 19, ELBO= 320394.160880, dELBO=0.000039 </span>
<span class="co">#&gt; iter = 20, ELBO= 320404.482598, dELBO=0.000032 </span>
<span class="co">#&gt; iter = 21, ELBO= 320413.146652, dELBO=0.000027 </span>
<span class="co">#&gt; iter = 22, ELBO= 320420.470080, dELBO=0.000023 </span>
<span class="co">#&gt; iter = 23, ELBO= 320426.699664, dELBO=0.000019 </span>
<span class="co">#&gt; iter = 24, ELBO= 320432.029390, dELBO=0.000017 </span>
<span class="co">#&gt; iter = 25, ELBO= 320436.613167, dELBO=0.000014 </span>
<span class="co">#&gt; iter = 26, ELBO= 320440.574186, dELBO=0.000012 </span>
<span class="co">#&gt; iter = 27, ELBO= 320444.011876, dELBO=0.000011 </span>
<span class="co">#&gt; iter = 28, ELBO= 320447.007121, dELBO=0.000009 </span>
<span class="co">#&gt; iter = 29, ELBO= 320449.626207, dELBO=0.000008 </span>
<span class="co">#&gt; iter = 30, ELBO= 320451.923844, dELBO=0.000007</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;    0.09    0.01    0.75</span></code></pre></div>
<p>Check the increased property of the envidence lower bound function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'ggplot2' was built under R version 4.1.3</span>
<span class="va">dat_iter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>iter<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">reslist</span><span class="op">$</span><span class="va">ELBO_seq</span><span class="op">)</span>, ELBO<span class="op">=</span><span class="va">reslist</span><span class="op">$</span><span class="va">ELBO_seq</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">dat_iter</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">iter</span>, y<span class="op">=</span><span class="va">ELBO</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></code></pre></div>
<p><img src="COAPsimu_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>We calculate the metrics to measure the estimatioin accuracy, where the trace statistic is used to measure the estimation accuracy of loading matrix and prediction accuracy of factor matrix, which is evaluated by the function <code><a href="https://rdrr.io/pkg/GFM/man/measurefun.html" class="external-link">measurefun()</a></code> in the R package <code>GFM</code>, and the root of mean square error is adopted to measure the estimation error of bbeta.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/feiyoung/GFM" class="external-link">GFM</a></span><span class="op">)</span>
<span class="va">metricList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">COAP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">COAP</span><span class="op">$</span><span class="va">Tr_H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GFM/man/measurefun.html" class="external-link">measurefun</a></span><span class="op">(</span><span class="va">reslist</span><span class="op">$</span><span class="va">H</span>, <span class="va">H0</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">COAP</span><span class="op">$</span><span class="va">Tr_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GFM/man/measurefun.html" class="external-link">measurefun</a></span><span class="op">(</span><span class="va">reslist</span><span class="op">$</span><span class="va">B</span>, <span class="va">B0</span><span class="op">)</span>

<span class="va">norm_vec</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">COAP</span><span class="op">$</span><span class="va">err_bb</span> <span class="op">&lt;-</span> <span class="fu">norm_vec</span><span class="op">(</span><span class="va">reslist</span><span class="op">$</span><span class="va">bbeta</span><span class="op">-</span><span class="va">bbeta0</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">COAP</span><span class="op">$</span><span class="va">err_bb1</span> <span class="op">&lt;-</span> <span class="fu">norm_vec</span><span class="op">(</span><span class="va">reslist</span><span class="op">$</span><span class="va">bbeta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="va">bbeta0</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">COAP</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="va">time_coap</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="compare-with-other-methods">Compare with other methods<a class="anchor" aria-label="anchor" href="#compare-with-other-methods"></a>
</h2>
<p>We compare COAP with various prominent methods in the literature. They are (1) High-dimensional LFM (Bai and Ng 2002) implemented in the R package GFM; (2) PoissonPCA (Kenney et al. 2021) implemented in the R package PoissonPCA; (3) Zero-inflated Poisson factor model (ZIPFA, Xu et al. 2021) implemented in the R package ZIPFA; (4) Generalized factor model (Liu et al. 2023) implemented in the R package GFM; (5) PLNPCA (Chiquet et al. 2018) implemented in the R package PLNmodels; (6) Generalized Linear Latent Variable Models (GLLVM, Hui et al. 2017) implemented in the R package gllvm. (7) Poisson regression model for each <span class="math inline">\(x_{ij}, (j = 1,··· ,p)\)</span>, implemented in stats R package; (8) Multi-response reduced-rank Poisson regression model (MMMR, Luo et al. 2018) implemented in rrpack R package.</p>
<p>(1). First, we implemented the linear factor model (LFM) and record the metrics that measure the estimation accuracy and computational cost.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">metricList</span><span class="op">$</span><span class="va">LFM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">tic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">fit_lfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GFM/man/Factorm.html" class="external-link">Factorm</a></span><span class="op">(</span><span class="va">X_count</span>, q<span class="op">=</span><span class="va">q</span><span class="op">)</span>
<span class="va">toc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">time_lfm</span> <span class="op">&lt;-</span> <span class="va">toc</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">tic</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>

<span class="va">hbb1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">X_count</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">LFM</span><span class="op">$</span><span class="va">Tr_H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GFM/man/measurefun.html" class="external-link">measurefun</a></span><span class="op">(</span><span class="va">fit_lfm</span><span class="op">$</span><span class="va">hH</span>, <span class="va">H0</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">LFM</span><span class="op">$</span><span class="va">Tr_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GFM/man/measurefun.html" class="external-link">measurefun</a></span><span class="op">(</span><span class="va">fit_lfm</span><span class="op">$</span><span class="va">hB</span>, <span class="va">B0</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">LFM</span><span class="op">$</span><span class="va">err_bb1</span> <span class="op">&lt;-</span> <span class="fu">norm_vec</span><span class="op">(</span><span class="va">hbb1</span><span class="op">-</span> <span class="va">bbeta0</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">LFM</span><span class="op">$</span><span class="va">err_bb</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">LFM</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="va">time_lfm</span></code></pre></div>
<p>(2). Then, we implemented PoissonPCA and recorded the metrics.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">metricList</span><span class="op">$</span><span class="va">PoissonPCA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">PoissonPCA</span><span class="op">)</span>
<span class="va">tic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">fit_poispca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PoissonPCA/man/Poisson_Corrected_PCA.html" class="external-link">Poisson_Corrected_PCA</a></span><span class="op">(</span><span class="va">X_count</span>, k<span class="op">=</span> <span class="va">hq</span><span class="op">)</span> 
<span class="co">#&gt; Warning in sqrt(eig$values): NaNs produced</span>
<span class="va">toc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">time_ppca</span> <span class="op">&lt;-</span> <span class="va">toc</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">tic</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>

<span class="va">hbb1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">X_count</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">PoissonPCA</span><span class="op">$</span><span class="va">Tr_H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GFM/man/measurefun.html" class="external-link">measurefun</a></span><span class="op">(</span><span class="va">fit_poispca</span><span class="op">$</span><span class="va">scores</span>, <span class="va">H0</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">PoissonPCA</span><span class="op">$</span><span class="va">Tr_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GFM/man/measurefun.html" class="external-link">measurefun</a></span><span class="op">(</span><span class="va">fit_poispca</span><span class="op">$</span><span class="va">loadings</span>, <span class="va">B0</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">PoissonPCA</span><span class="op">$</span><span class="va">err_bb1</span> <span class="op">&lt;-</span> <span class="fu">norm_vec</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">fit_poispca</span><span class="op">$</span><span class="va">center</span><span class="op">)</span><span class="op">-</span> <span class="va">bbeta0</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">PoissonPCA</span><span class="op">$</span><span class="va">err_bb</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">PoissonPCA</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="va">time_ppca</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Thirdly, we implemented the zero-inflated Poisson factor model:</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co">## ZIPFA runs very slowly, so we do not run it here.</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">library</span>(ZIPFA)</a>
<a class="sourceLine" id="cb8-3" title="3">metricList<span class="op">$</span>ZIPFA &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb8-4" title="4"><span class="kw">system.time</span>(</a>
<a class="sourceLine" id="cb8-5" title="5">  tic &lt;-<span class="st"> </span><span class="kw">proc.time</span>()</a>
<a class="sourceLine" id="cb8-6" title="6">  fit_zipfa &lt;-<span class="st"> </span><span class="kw">ZIPFA</span>(X_count, <span class="dt">k=</span>hq, <span class="dt">display =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb8-7" title="7">  toc &lt;-<span class="st"> </span><span class="kw">proc.time</span>()</a>
<a class="sourceLine" id="cb8-8" title="8">  time_zipfa &lt;-<span class="st"> </span>toc[<span class="dv">3</span>] <span class="op">-</span><span class="st"> </span>tic[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb8-9" title="9">)</a>
<a class="sourceLine" id="cb8-10" title="10"></a>
<a class="sourceLine" id="cb8-11" title="11"></a>
<a class="sourceLine" id="cb8-12" title="12">  </a>
<a class="sourceLine" id="cb8-13" title="13">idx_max_like &lt;-<span class="st"> </span><span class="kw">which.max</span>(fit_zipfa<span class="op">$</span>Likelihood) </a>
<a class="sourceLine" id="cb8-14" title="14">hbb1 &lt;-<span class="st"> </span><span class="kw">colMeans</span>(X_count)</a>
<a class="sourceLine" id="cb8-15" title="15">metricList<span class="op">$</span>ZIPFA<span class="op">$</span>Tr_H &lt;-<span class="st"> </span><span class="kw">measurefun</span>(fit_zipfa<span class="op">$</span>Ufit[[idx_max_like]], H0)</a>
<a class="sourceLine" id="cb8-16" title="16">metricList<span class="op">$</span>ZIPFA<span class="op">$</span>Tr_B &lt;-<span class="st"> </span><span class="kw">measurefun</span>(fit_zipfa<span class="op">$</span>Vfit[[idx_max_like]], B0)</a>
<a class="sourceLine" id="cb8-17" title="17">metricList<span class="op">$</span>PoissonPCA<span class="op">$</span>Time &lt;-<span class="st"> </span>time_zipfa</a></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Fourthly, we also applied the generalized factor model to estimate the loading matrix and factor matrix.</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">metricList</span><span class="op">$</span><span class="va">GFM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">tic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">fit_gfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GFM/man/gfm.html" class="external-link">gfm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">X_count</span><span class="op">)</span>,  type<span class="op">=</span><span class="st">'poisson'</span>, q<span class="op">=</span> <span class="va">q</span>, verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="va">toc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">time_gfm</span> <span class="op">&lt;-</span> <span class="va">toc</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">tic</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">GFM</span><span class="op">$</span><span class="va">Tr_H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GFM/man/measurefun.html" class="external-link">measurefun</a></span><span class="op">(</span><span class="va">fit_gfm</span><span class="op">$</span><span class="va">hH</span>, <span class="va">H0</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">GFM</span><span class="op">$</span><span class="va">Tr_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GFM/man/measurefun.html" class="external-link">measurefun</a></span><span class="op">(</span><span class="va">fit_gfm</span><span class="op">$</span><span class="va">hB</span>, <span class="va">B0</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">GFM</span><span class="op">$</span><span class="va">err_bb1</span> <span class="op">&lt;-</span> <span class="fu">norm_vec</span><span class="op">(</span><span class="va">fit_gfm</span><span class="op">$</span><span class="va">hmu</span><span class="op">-</span> <span class="va">bbeta0</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">GFM</span><span class="op">$</span><span class="va">err_bb</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">GFM</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="va">time_gfm</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Fifthly, we implemented PLNPCA:</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">PLNPCA_run</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X_count</span>, <span class="va">covariates</span>, <span class="va">q</span>,  <span class="va">Offset</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X_count</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://pln-team.github.io/PLNmodels/" class="external-link">PLNmodels</a></span><span class="op">)</span>
 
  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character</a></span><span class="op">(</span><span class="va">Offset</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">dat_plnpca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pln-team.github.io/PLNmodels/reference/prepare_data.html" class="external-link">prepare_data</a></span><span class="op">(</span><span class="va">X_count</span>, <span class="va">covariates</span><span class="op">)</span>
    <span class="va">dat_plnpca</span><span class="op">$</span><span class="va">Offset</span> <span class="op">&lt;-</span> <span class="va">Offset</span>
  <span class="op">}</span><span class="kw">else</span><span class="op">{</span>
    <span class="va">dat_plnpca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pln-team.github.io/PLNmodels/reference/prepare_data.html" class="external-link">prepare_data</a></span><span class="op">(</span><span class="va">X_count</span>, <span class="va">covariates</span>, offset <span class="op">=</span> <span class="va">Offset</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">covariates</span><span class="op">)</span>
  <span class="co">#  offset(log(Offset))+</span>
  <span class="va">formu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Abundance ~ 1 + offset(log(Offset))+"</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"V"</span>,<span class="fl">1</span><span class="op">:</span><span class="va">d</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">'+'</span><span class="op">)</span><span class="op">)</span>
  
  
  <span class="va">myPCA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pln-team.github.io/PLNmodels/reference/PLNPCA.html" class="external-link">PLNPCA</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="va">formu</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat_plnpca</span>, ranks <span class="op">=</span> <span class="va">q</span><span class="op">)</span>
  
  <span class="va">myPCA1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pln-team.github.io/PLNmodels/reference/getBestModel.html" class="external-link">getBestModel</a></span><span class="op">(</span><span class="va">myPCA</span><span class="op">)</span>
  <span class="va">myPCA1</span><span class="op">$</span><span class="va">scores</span>
  
  <span class="va">res_plnpca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>PCs<span class="op">=</span> <span class="va">myPCA1</span><span class="op">$</span><span class="va">scores</span>, bbeta<span class="op">=</span> <span class="va">myPCA1</span><span class="op">$</span><span class="va">model_par</span><span class="op">$</span><span class="va">B</span>, 
                     loadings<span class="op">=</span><span class="va">myPCA1</span><span class="op">$</span><span class="va">model_par</span><span class="op">$</span><span class="va">C</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res_plnpca</span><span class="op">)</span>
<span class="op">}</span>



  <span class="va">tic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">fit_plnpca</span> <span class="op">&lt;-</span> <span class="fu">PLNPCA_run</span><span class="op">(</span><span class="va">X_count</span>,  covariates <span class="op">=</span> <span class="va">Z</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>, q<span class="op">=</span> <span class="va">q</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: PLNmodels</span>
<span class="co">#&gt; Warning: package 'PLNmodels' was built under R version 4.1.3</span>
<span class="co">#&gt; This is packages 'PLNmodels' version 1.0.1</span>
<span class="co">#&gt; Use future::plan(multicore/multisession) to speed up PLNPCA/PLNmixture/stability_selection.</span>
<span class="co">#&gt; Warning in common_samples(counts, covariates): There are no matching names in the count matrix and the covariates data.frame.</span>
<span class="co">#&gt; Function will proceed assuming:</span>
<span class="co">#&gt; - samples are in the same order;</span>
<span class="co">#&gt; - samples are rows of the abundance matrix.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Initialization...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Adjusting 1 PLN models for PCA analysis.</span>
<span class="co">#&gt;   Rank approximation = 5 </span>
<span class="co">#&gt;  Post-treatments</span>
<span class="co">#&gt;  DONE!</span>
  <span class="va">toc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">time_plnpca</span> <span class="op">&lt;-</span> <span class="va">toc</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">tic</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="va">time_plnpca</span>, <span class="st">" seconds"</span><span class="op">)</span>
<span class="co">#&gt; 37.86 seconds</span>

<span class="va">metricList</span><span class="op">$</span><span class="va">PLNPCA</span><span class="op">$</span><span class="va">Tr_H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GFM/man/measurefun.html" class="external-link">measurefun</a></span><span class="op">(</span><span class="va">fit_plnpca</span><span class="op">$</span><span class="va">PCs</span>, <span class="va">H0</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">PLNPCA</span><span class="op">$</span><span class="va">Tr_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GFM/man/measurefun.html" class="external-link">measurefun</a></span><span class="op">(</span><span class="va">fit_plnpca</span><span class="op">$</span><span class="va">loadings</span>, <span class="va">B0</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">PLNPCA</span><span class="op">$</span><span class="va">err_bb1</span> <span class="op">&lt;-</span> <span class="fu">norm_vec</span><span class="op">(</span><span class="va">fit_plnpca</span><span class="op">$</span><span class="va">bbeta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">-</span> <span class="va">bbeta0</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">PLNPCA</span><span class="op">$</span><span class="va">err_bb</span> <span class="op">&lt;-</span> <span class="fu">norm_vec</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">fit_plnpca</span><span class="op">$</span><span class="va">bbeta</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">bbeta0</span><span class="op">)</span><span class="op">)</span> 
<span class="va">metricList</span><span class="op">$</span><span class="va">PLNPCA</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="va">time_plnpca</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Sixthly, we implement the generalized linear latent variable models (GLLVM, Hui et al. 2017).</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co">## GLLVM runs very slowly, so we do not run it here.</span></a>
<a class="sourceLine" id="cb11-2" title="2"></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="kw">library</span>(gllvm)</a>
<a class="sourceLine" id="cb11-4" title="4"><span class="kw">colnames</span>(Z) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">paste0</span>(<span class="st">"V"</span>,<span class="dv">1</span><span class="op">:</span><span class="st"> </span><span class="kw">ncol</span>(Z)))</a>
<a class="sourceLine" id="cb11-5" title="5">tic &lt;-<span class="st"> </span><span class="kw">proc.time</span>()</a>
<a class="sourceLine" id="cb11-6" title="6">fit &lt;-<span class="st"> </span><span class="kw">gllvm</span>(<span class="dt">y=</span>X_count, <span class="dt">X=</span>Z, <span class="dt">family=</span><span class="kw">poisson</span>(), <span class="dt">num.lv=</span> q, <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">trace=</span>T))</a>
<a class="sourceLine" id="cb11-7" title="7">toc &lt;-<span class="st"> </span><span class="kw">proc.time</span>()</a>
<a class="sourceLine" id="cb11-8" title="8">time_gllvm &lt;-<span class="st"> </span>toc[<span class="dv">3</span>] <span class="op">-</span><span class="st"> </span>tic[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb11-9" title="9"></a>
<a class="sourceLine" id="cb11-10" title="10">metricList<span class="op">$</span>GLLVM &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb11-11" title="11">metricList<span class="op">$</span>GLLVM<span class="op">$</span>Tr_H &lt;-<span class="st"> </span><span class="kw">measurefun</span>(fit<span class="op">$</span>lvs, H0)</a>
<a class="sourceLine" id="cb11-12" title="12">metricList<span class="op">$</span>GLLVM<span class="op">$</span>Tr_B &lt;-<span class="st"> </span><span class="kw">measurefun</span>(fit<span class="op">$</span>params<span class="op">$</span>theta, B0)</a>
<a class="sourceLine" id="cb11-13" title="13">metricList<span class="op">$</span>GLLVM<span class="op">$</span>err_bb1 &lt;-<span class="st"> </span><span class="kw">norm_vec</span>(fit<span class="op">$</span>params<span class="op">$</span>beta0<span class="op">-</span><span class="st"> </span>bbeta0[,<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb11-14" title="14">metricList<span class="op">$</span>GLLVM<span class="op">$</span>err_bb &lt;-<span class="st"> </span><span class="kw">norm_vec</span>(<span class="kw">as.vector</span>(<span class="kw">cbind</span>(fit<span class="op">$</span>params<span class="op">$</span>beta0,fit<span class="op">$</span>params<span class="op">$</span>Xcoef)) <span class="op">-</span><span class="st"> </span><span class="kw">as.vector</span>(bbeta0)) </a>
<a class="sourceLine" id="cb11-15" title="15">metricList<span class="op">$</span>GLLVM<span class="op">$</span>Time &lt;-<span class="st"> </span>time_gllvm</a>
<a class="sourceLine" id="cb11-16" title="16"><span class="er">}</span></a></code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>Seventhly, Poisson regression model for each variable was implemented.</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">PoisReg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X_count</span>, <span class="va">covariates</span><span class="op">)</span><span class="op">{</span>
     <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">stats</span><span class="op">)</span>
     <span class="va">hbbeta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">X_count</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
       <span class="va">glm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">x</span><span class="op">~</span><span class="va">covariates</span><span class="op">+</span><span class="fl">0</span>, family <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span>
       <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">glm1</span><span class="op">)</span>
     <span class="op">}</span> <span class="op">)</span>
     <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">hbbeta</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">tic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">hbbeta_poisreg</span> <span class="op">&lt;-</span> <span class="fu">PoisReg</span><span class="op">(</span><span class="va">X_count</span>, <span class="va">Z</span><span class="op">)</span>
<span class="va">toc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">time_poisreg</span> <span class="op">&lt;-</span> <span class="va">toc</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">tic</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">GLM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">GLM</span><span class="op">$</span><span class="va">Tr_H</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">GLM</span><span class="op">$</span><span class="va">Tr_B</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">GLM</span><span class="op">$</span><span class="va">err_bb1</span> <span class="op">&lt;-</span> <span class="fu">norm_vec</span><span class="op">(</span><span class="va">hbbeta_poisreg</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">-</span> <span class="va">bbeta0</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">GLM</span><span class="op">$</span><span class="va">err_bb</span> <span class="op">&lt;-</span> <span class="fu">norm_vec</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">hbbeta_poisreg</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">bbeta0</span><span class="op">)</span><span class="op">)</span> 
<span class="va">metricList</span><span class="op">$</span><span class="va">GLM</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="va">time_poisreg</span></code></pre></div>
<ol start="8" style="list-style-type: decimal">
<li>Eightly, we implemented the first version of multi-response reduced-rank Poisson regression model (MMMR, Luo et al. 2018) implemented in rrpack R package (MRRR-Z), that did not consider the latent factor structure but only the covariates.</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mrrr_run</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Y</span>, <span class="va">X</span>, <span class="va">rank0</span>, <span class="va">q</span><span class="op">=</span><span class="cn">NULL</span>, <span class="va">family</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="va">familygroup</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  
  
  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">rrpack</span><span class="op">)</span>
  
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>; <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>
  
  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">rank0</span> <span class="op">&lt;-</span> <span class="va">rank0</span><span class="op">+</span><span class="va">q</span>
    <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">X</span>, <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="va">svdX0d1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/svd.html" class="external-link">svd</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">$</span><span class="va">d</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
  <span class="va">init1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>kappaC0 <span class="op">=</span> <span class="va">svdX0d1</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span> <span class="co">## this setting follows the example that authors provided.</span>
  
  <span class="va">fit.mrrr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rrpack/man/mrrr.html" class="external-link">mrrr</a></span><span class="op">(</span>Y<span class="op">=</span><span class="va">Y</span>, X<span class="op">=</span><span class="va">X</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>, family <span class="op">=</span> <span class="va">family</span>, familygroup <span class="op">=</span> <span class="va">familygroup</span>,
                   penstr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>penaltySVD <span class="op">=</span> <span class="st">"rankCon"</span>, lambdaSVD <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,
                   init <span class="op">=</span> <span class="va">init1</span>, maxrank <span class="op">=</span> <span class="va">rank0</span><span class="op">)</span>
  <span class="va">hbbeta_mrrr</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">fit.mrrr</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">Theta_hb</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">fit.mrrr</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span>
    <span class="va">svdTheta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/svd.html" class="external-link">svd</a></span><span class="op">(</span><span class="va">Theta_hb</span>, nu<span class="op">=</span><span class="va">q</span>, nv<span class="op">=</span><span class="va">q</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>hbbeta<span class="op">=</span><span class="va">hbbeta_mrrr</span>, factor<span class="op">=</span><span class="va">svdTheta</span><span class="op">$</span><span class="va">u</span>, loading<span class="op">=</span><span class="va">svdTheta</span><span class="op">$</span><span class="va">v</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span><span class="kw">else</span><span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>hbbeta<span class="op">=</span><span class="va">hbbeta_mrrr</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  
  
<span class="op">}</span>
<span class="va">tic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">res_mrrrz</span> <span class="op">&lt;-</span> <span class="fu">mrrr_run</span><span class="op">(</span><span class="va">X_count</span>, <span class="va">Z</span>, <span class="va">rank0</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: rrpack</span>
<span class="va">toc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">time_mrrrz</span> <span class="op">&lt;-</span> <span class="va">toc</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">tic</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>

<span class="va">metricList</span><span class="op">$</span><span class="va">MRRR_Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">MRRR_Z</span><span class="op">$</span><span class="va">Tr_H</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">MRRR_Z</span><span class="op">$</span><span class="va">Tr_B</span> <span class="op">&lt;-</span><span class="cn">NA</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">MRRR_Z</span><span class="op">$</span><span class="va">err_bb1</span> <span class="op">&lt;-</span> <span class="fu">norm_vec</span><span class="op">(</span><span class="va">res_mrrrz</span><span class="op">$</span><span class="va">hbbeta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">-</span> <span class="va">bbeta0</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">MRRR_Z</span><span class="op">$</span><span class="va">err_bb</span> <span class="op">&lt;-</span> <span class="fu">norm_vec</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">res_mrrrz</span><span class="op">$</span><span class="va">hbbeta</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">bbeta0</span><span class="op">)</span><span class="op">)</span> 
<span class="va">metricList</span><span class="op">$</span><span class="va">MRRR_Z</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="va">time_mrrrz</span></code></pre></div>
<ol start="9" style="list-style-type: decimal">
<li>Lastly, we implemented the second version of MRRR (MRRR-F) that considered both covariates and the latent factor structure.</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">res_mrrrf</span> <span class="op">&lt;-</span> <span class="fu">mrrr_run</span><span class="op">(</span><span class="va">X_count</span>, <span class="va">Z</span>, <span class="va">rank0</span>, q<span class="op">=</span><span class="va">q</span><span class="op">)</span>
<span class="va">toc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">time_mrrrf</span> <span class="op">&lt;-</span> <span class="va">toc</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">tic</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">MRRR_F</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">MRRR_F</span><span class="op">$</span><span class="va">Tr_H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GFM/man/measurefun.html" class="external-link">measurefun</a></span><span class="op">(</span><span class="va">res_mrrrf</span><span class="op">$</span><span class="va">factor</span>, <span class="va">H0</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">MRRR_F</span><span class="op">$</span><span class="va">Tr_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/GFM/man/measurefun.html" class="external-link">measurefun</a></span><span class="op">(</span><span class="va">res_mrrrf</span><span class="op">$</span><span class="va">loading</span>, <span class="va">B0</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">MRRR_F</span><span class="op">$</span><span class="va">err_bb1</span> <span class="op">&lt;-</span> <span class="fu">norm_vec</span><span class="op">(</span><span class="va">res_mrrrf</span><span class="op">$</span><span class="va">hbbeta</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">-</span> <span class="va">bbeta0</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">metricList</span><span class="op">$</span><span class="va">MRRR_F</span><span class="op">$</span><span class="va">err_bb</span> <span class="op">&lt;-</span> <span class="fu">norm_vec</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">res_mrrrf</span><span class="op">$</span><span class="va">hbbeta</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">bbeta0</span><span class="op">)</span><span class="op">)</span> 
<span class="va">metricList</span><span class="op">$</span><span class="va">MRRR_F</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="va">time_mrrrf</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualize-the-comparison-of-performance">Visualize the comparison of performance<a class="anchor" aria-label="anchor" href="#visualize-the-comparison-of-performance"></a>
</h2>
<p>Next, we summarized the metrics for COAP and other compared methods in a dataframe object.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">list2vec</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">xlist</span><span class="op">)</span><span class="op">{</span>
  <span class="va">nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xlist</span><span class="op">)</span>
  <span class="va">me</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">nn</span><span class="op">)</span>
  <span class="va">idx_noNA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">xlist</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">r</span> <span class="kw">in</span> <span class="va">idx_noNA</span><span class="op">)</span> <span class="va">me</span><span class="op">[</span><span class="va">r</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">xlist</span><span class="op">[[</span><span class="va">r</span><span class="op">]</span><span class="op">]</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">me</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">dat_metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Tr_H <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">metricList</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">Tr_H</span><span class="op">)</span>, 
                         Tr_B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">metricList</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">Tr_B</span><span class="op">)</span>,
                         err_bb1 <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">metricList</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">err_bb1</span><span class="op">)</span>,
                         err_bb <span class="op">=</span> <span class="fu">list2vec</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">metricList</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[[</span><span class="st">'err_bb'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,
                         Method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">metricList</span><span class="op">)</span><span class="op">)</span>
<span class="va">dat_metric</span>
<span class="co">#&gt;                 Tr_H      Tr_B   err_bb1     err_bb     Method</span>
<span class="co">#&gt; COAP       0.9735503 0.9653009 0.2350772 0.05569392       COAP</span>
<span class="co">#&gt; LFM        0.2248456 0.2200929 5.0689133         NA        LFM</span>
<span class="co">#&gt; PoissonPCA 0.2160776 0.2203730 1.6349874         NA PoissonPCA</span>
<span class="co">#&gt; GFM        0.9563598 0.9618231 0.3049976         NA        GFM</span>
<span class="co">#&gt; PLNPCA     0.9408787 0.9505264 0.1595667 0.22585069     PLNPCA</span>
<span class="co">#&gt; GLM               NA        NA 0.6897184 0.24198444        GLM</span>
<span class="co">#&gt; MRRR_Z            NA        NA 1.0844298 0.18969631     MRRR_Z</span>
<span class="co">#&gt; MRRR_F     0.3599355 0.1891922 0.9775735 0.18778301     MRRR_F</span></code></pre></div>
<p>Plot the results for COAP and other methods, which suggests that COAP achieves better estimation accuracy for the quantiites of interest.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dat_metric</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Tr_B</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">Method</span>, y<span class="op">=</span><span class="va">Tr_B</span>, fill<span class="op">=</span><span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dat_metric</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Tr_H</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">Method</span>, y<span class="op">=</span><span class="va">Tr_H</span>, fill<span class="op">=</span><span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>
<span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dat_metric</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">err_bb1</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">Method</span>, y<span class="op">=</span><span class="va">err_bb1</span>, fill<span class="op">=</span><span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>
<span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dat_metric</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">err_bb</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">Method</span>, y<span class="op">=</span><span class="va">err_bb</span>, fill<span class="op">=</span><span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>
<span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>,<span class="va">p2</span>,<span class="va">p3</span>, <span class="va">p4</span>, nrow<span class="op">=</span><span class="fl">2</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="COAPsimu_files/figure-html/unnamed-chunk-17-1.png" width="864"></p>
</div>
<div class="section level2">
<h2 id="select-the-parameters">Select the parameters<a class="anchor" aria-label="anchor" href="#select-the-parameters"></a>
</h2>
<p>We applied the singular value ratio based method to select the number of factors and the rank of coefficient matrix. The results showed that the SVR method has the potential to identify the true values.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datList</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gendata_simu.html">gendata_simu</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">1</span>, n<span class="op">=</span><span class="va">n</span>, p<span class="op">=</span><span class="va">p</span>, d<span class="op">=</span> <span class="va">d</span>, rank0 <span class="op">=</span> <span class="va">rank0</span>, q<span class="op">=</span> <span class="va">q</span>, rho<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">6</span><span class="op">)</span>,
                        sigma2_eps <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">X_count</span> <span class="op">&lt;-</span> <span class="va">datList</span><span class="op">$</span><span class="va">X</span>; <span class="va">Z</span> <span class="op">&lt;-</span> <span class="va">datList</span><span class="op">$</span><span class="va">Z</span>
<span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/selectParams.html">selectParams</a></span><span class="op">(</span>X_count<span class="op">=</span><span class="va">datList</span><span class="op">$</span><span class="va">X</span>, Z<span class="op">=</span><span class="va">datList</span><span class="op">$</span><span class="va">Z</span>, verbose<span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="co">#&gt; Calculate initial values...</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>q_true<span class="op">=</span><span class="va">q</span>, q_est<span class="op">=</span><span class="va">res1</span><span class="op">[</span><span class="st">'hq'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;   q_true q_est.hq </span>
<span class="co">#&gt;        5        5</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>r_true<span class="op">=</span><span class="va">rank0</span>, r_est<span class="op">=</span><span class="va">res1</span><span class="op">[</span><span class="st">'hr'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;   r_true r_est.hr </span>
<span class="co">#&gt;        6        6</span></code></pre></div>
<details><p><summary><strong>Session Info</strong></summary></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; R version 4.1.2 (2021-11-01)</span>
<span class="co">#&gt; Platform: x86_64-w64-mingw32/x64 (64-bit)</span>
<span class="co">#&gt; Running under: Windows 10 x64 (build 22621)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt; [1] LC_COLLATE=Chinese (Simplified)_China.936 </span>
<span class="co">#&gt; [2] LC_CTYPE=Chinese (Simplified)_China.936   </span>
<span class="co">#&gt; [3] LC_MONETARY=Chinese (Simplified)_China.936</span>
<span class="co">#&gt; [4] LC_NUMERIC=C                              </span>
<span class="co">#&gt; [5] LC_TIME=Chinese (Simplified)_China.936    </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] parallel  stats     graphics  grDevices utils     datasets  methods  </span>
<span class="co">#&gt; [8] base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt;  [1] cowplot_1.1.1    rrpack_0.1-11    PLNmodels_1.0.1  PoissonPCA_1.0.3</span>
<span class="co">#&gt;  [5] ggplot2_3.4.1    irlba_2.3.5      Matrix_1.4-0     MASS_7.3-55     </span>
<span class="co">#&gt;  [9] GFM_1.2.1        doSNOW_1.0.20    snow_0.4-4       iterators_1.0.14</span>
<span class="co">#&gt; [13] foreach_1.5.2    COAP_1.1        </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] tidyr_1.2.0           sass_0.4.1            splines_4.1.2        </span>
<span class="co">#&gt;  [4] bit64_4.0.5           jsonlite_1.8.0        bslib_0.3.1          </span>
<span class="co">#&gt;  [7] assertthat_0.2.1      highr_0.9             yaml_2.3.6           </span>
<span class="co">#&gt; [10] corrplot_0.92         globals_0.15.0        pillar_1.9.0         </span>
<span class="co">#&gt; [13] lattice_0.20-45       glue_1.6.2            torch_0.9.1          </span>
<span class="co">#&gt; [16] digest_0.6.29         colorspace_2.1-0      htmltools_0.5.2      </span>
<span class="co">#&gt; [19] pkgconfig_2.0.3       listenv_0.8.0         purrr_0.3.4          </span>
<span class="co">#&gt; [22] scales_1.2.1          processx_3.5.2        tibble_3.2.1         </span>
<span class="co">#&gt; [25] generics_0.1.2        farver_2.1.1          cachem_1.0.6         </span>
<span class="co">#&gt; [28] withr_2.5.0           cli_3.2.0             survival_3.2-13      </span>
<span class="co">#&gt; [31] magrittr_2.0.3        crayon_1.5.1          memoise_2.0.1        </span>
<span class="co">#&gt; [34] evaluate_0.15         ps_1.6.0              fs_1.5.2             </span>
<span class="co">#&gt; [37] fansi_1.0.4           future_1.26.1         parallelly_1.32.0    </span>
<span class="co">#&gt; [40] textshaping_0.3.6     tools_4.1.2           lifecycle_1.0.3      </span>
<span class="co">#&gt; [43] lassoshooting_0.1.5-1 stringr_1.4.0         glassoFast_1.0       </span>
<span class="co">#&gt; [46] glmnet_4.1-3          munsell_0.5.0         callr_3.7.0          </span>
<span class="co">#&gt; [49] compiler_4.1.2        pkgdown_2.0.6         jquerylib_0.1.4      </span>
<span class="co">#&gt; [52] systemfonts_1.0.4     rlang_1.1.0           grid_4.1.2           </span>
<span class="co">#&gt; [55] nloptr_2.0.0          rstudioapi_0.13       igraph_1.3.5         </span>
<span class="co">#&gt; [58] labeling_0.4.2        rmarkdown_2.11        gtable_0.3.3         </span>
<span class="co">#&gt; [61] codetools_0.2-18      DBI_1.1.2             R6_2.5.1             </span>
<span class="co">#&gt; [64] gridExtra_2.3         knitr_1.37            dplyr_1.0.9          </span>
<span class="co">#&gt; [67] fastmap_1.1.0         future.apply_1.9.0    bit_4.0.4            </span>
<span class="co">#&gt; [70] utf8_1.2.3            rprojroot_2.0.3       ragg_1.2.2           </span>
<span class="co">#&gt; [73] coro_1.0.3            shape_1.4.6           desc_1.4.0           </span>
<span class="co">#&gt; [76] stringi_1.7.6         Rcpp_1.0.10           vctrs_0.6.1          </span>
<span class="co">#&gt; [79] tidyselect_1.1.2      xfun_0.29</span></code></pre></div>
</details>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Wei Liu, Qingzhi Zhong.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
